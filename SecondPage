import React, { useEffect, useRef } from 'react';
import { gsap } from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

gsap.registerPlugin(ScrollTrigger);

interface ScrollRevealProps {
  text?: string;
}

const ScrollRevealParagraph: React.FC<ScrollRevealProps> = ({ 
  text = `"The cosmos is within us. We are made of star-stuff. We are a way for the universe to know itself. Somewhere, something incredible is waiting to be known."` 
}) => {
  // Container ref for the ScrollTrigger
  const containerRef = useRef<HTMLParagraphElement>(null);
  
  // Array ref to hold each individual span (letter)
  const lettersRef = useRef<HTMLSpanElement[]>([]);

  // Function to clean up and assign refs
  const addToRefs = (el: HTMLSpanElement | null) => {
    if (el && !lettersRef.current.includes(el)) {
      lettersRef.current.push(el);
    }
  };

  useEffect(() => {
    if (!containerRef.current) return;

    const ctx = gsap.context(() => {
      gsap.fromTo(
        lettersRef.current,
        { 
          opacity: 0.2,
        //   y: 20,
        //   filter: "blur(5px)"
        },
        {
          opacity: 1,
          y: 0,
        delay: 2,
        //   filter: "blur(0px)",
          duration: 5,
          ease: "power3.out",
          stagger: 0.9,
          scrollTrigger: {
            trigger: containerRef.current,
            start: "top 80%",
            end: "top 30%",
            scrub: 1, // Adds a slight "smooth" lag for better feel
            markers: true,
          },
        }
      );
    });

    return () => ctx.revert(); // Clean up all animations and triggers
  }, []);

  return (
    <div  className='h-screen bg-black flex items-center justify-center'>
      <p
        ref={containerRef}
        style={{
          color: "#fff",
          fontSize: "clamp(2rem, 5vw, 4rem)", // Responsive font size
          fontWeight: 700,
          lineHeight: 1.2,
          maxWidth: "1000px",
          margin: "0 auto",
          display: "flex",
          flexWrap: "wrap",
          padding: "0 20px"
        }}
      >
        {text.split("").map((char, index) => (
          <span
            key={`${char}-${index}`}
            ref={addToRefs}
            style={{ 
                display: "inline-block", 
                whiteSpace: char === " " ? "pre" : "normal" 
            }}
          >
            {char}
          </span>
        ))}
      </p>
    </div>
  );
};

export default ScrollRevealParagraph;
